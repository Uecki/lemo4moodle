define(["jquery","jqueryui","blocks_lemo4moodle/plotly","blocks_lemo4moodle/materialize","blocks_lemo4moodle/lemo_view"],function(a,b,c,d){function e(){function b(){for(var a=[h+"<br>00:00-06:00",i+"<br>00:00-06:00",h+"<br>06:00-12:00",i+"<br>06:00-12:00",h+"<br>12:00-18:00",i+"<br>12:00-18:00",h+"<br>18:00-24:00",i+"<br>18:00-24:00",h+"<br>"+j,i+"<br>"+j,h+"<br>"+k,i+"<br>"+k],b=[l,m,n,o,p,q,r],d=e,f=[[0,"#ffffff"],[1,"#4a9dd4"]],s=[{x:a,y:b,z:d,type:"heatmap",colorscale:f,showscale:!1}],t={title:g,annotations:[],xaxis:{ticks:"",side:"top"},yaxis:{ticks:"",ticksuffix:" ",width:700,height:700,autosize:!1}},u=0;u<b.length;u++)for(var v=0;v<a.length;v++){var w=d[u][v];if(0!=w)var x="black";else var x="black";var y={xref:"x1",yref:"y1",x:a[v],y:b[u],text:d[u][v],font:{family:"Arial",size:12,color:x},showarrow:!1};t.annotations.push(y)}c.newPlot("heatmap",s,t)}var e=JSON.parse(a("#heatmapData").val()),f=Object.entries(JSON.parse(a("#heatmapDataFilter").val())),g=a("#heatmapTitle").val(),h=a("#heatmapAll").val(),i=a("#heatmapOwn").val(),j=a("#heatmapOverall").val(),k=a("#heatmapAverage").val(),l=a("#heatmapMonday").val(),m=a("#heatmapTuesday").val(),n=a("#heatmapWednesday").val(),o=a("#heatmapThursday").val(),p=a("#heatmapFriday").val(),q=a("#heatmapSaturday").val(),r=a("#heatmapSunday").val(),s=a("#heatmapCheckSelection").val();a(document).ready(function(){a("#rst_btn_3").click(function(){b(),a("#datepicker_5").val(""),a("#datepicker_6").val("")}),a("#dp_button_3").click(function(){var b=document.getElementById("datepicker_5").value,e=document.getElementById("datepicker_6").value,t=b.split(".");b=t[1]+"/"+t[0]+"/"+t[2];var u=e.split(".");e=u[1]+"/"+u[0]+"/"+u[2],b+=" 00:00:00",e+=" 23:59:59";var v=block_lemo4moodle_toTimestamp(b),w=block_lemo4moodle_toTimestamp(e);if(v<=w){var x,y=[],z=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],A={Monday:0,Tuesday:0,Wednesday:0,Thursday:0,Friday:0,Saturday:0,Sunday:0},B={Monday:0,Tuesday:0,Wednesday:0,Thursday:0,Friday:0,Saturday:0,Sunday:0},C={Monday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:0},Tuesday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:1},Wednesday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:2},Thursday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:3},Friday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:4},Saturday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:5},Sunday:{"0to6":{all:{col:0,value:0},own:{col:1,value:0}},"6to12":{all:{col:2,value:0},own:{col:3,value:0}},"12to18":{all:{col:4,value:0},own:{col:5,value:0}},"18to24":{all:{col:6,value:0},own:{col:7,value:0}},row:6}};f.forEach(function(a){a[1].timecreated>=v&&a[1].timecreated<=w&&(parseInt(a[1].hour)>=0&&parseInt(a[1].hour)<6?x="0to6":parseInt(a[1].hour)>=6&&parseInt(a[1].hour)<12?x="6to12":parseInt(a[1].hour)>=12&&parseInt(a[1].hour)<18?x="12to18":parseInt(a[1].hour)>=18&&parseInt(a[1].hour)<24&&(x="18to24"),C[a[1].weekday][x].all.value+=parseInt(a[1].allhits),C[a[1].weekday][x].own.value+=parseInt(a[1].ownhits),A[a[1].weekday]+=parseInt(a[1].allhits),B[a[1].weekday]+=parseInt(a[1].ownhits))});for(var D=0;D<=6;)y.push([C[z[D]]["0to6"].all.value,C[z[D]]["0to6"].own.value,C[z[D]]["6to12"].all.value,C[z[D]]["6to12"].own.value,C[z[D]]["12to18"].all.value,C[z[D]]["12to18"].own.value,C[z[D]]["18to24"].all.value,C[z[D]]["18to24"].own.value,A[z[D]],B[z[D]],Math.round(A[z[D]]/4),Math.round(B[z[D]]/4)]),D+=1;for(var E=[h+"<br>00:00-06:00",i+"<br>00:00-06:00",h+"<br>06:00-12:00",i+"<br>06:00-12:00",h+"<br>12:00-18:00",i+"<br>12:00-18:00",h+"<br>18:00-24:00",i+"<br>18:00-24:00",h+"<br>"+j,i+"<br>"+j,h+"<br>"+k,i+"<br>"+k],F=[l,m,n,o,p,q,r],G=y,H=[[0,"#ffffff"],[1,"#4a9dd4"]],I=[{x:E,y:F,z:G,type:"heatmap",colorscale:H,showscale:!1}],J={title:g,annotations:[],xaxis:{ticks:"",side:"top"},yaxis:{ticks:"",ticksuffix:" ",width:700,height:700,autosize:!1}},K=0;K<F.length;K++)for(var L=0;L<E.length;L++){var M=G[K][L];if(0!=M)var N="black";else var N="black";var O={xref:"x1",yref:"y1",x:E[L],y:F[K],text:G[K][L],font:{family:"Arial",size:12,color:N},showarrow:!1};J.annotations.push(O)}c.newPlot("heatmap",I,J)}else d.toast(s,3e3),a("#datepicker_5").val(""),a("#datepicker_6").val("")}),a("#html_btn_3").click(function(){a("#dialog").dialog("open")}),a(window).resize(function(){b()}),a("#tabs").tabs({onShow:b})})}return{init:function(){e()}}});