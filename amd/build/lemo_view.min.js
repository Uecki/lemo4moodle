define(["jquery","jqueryui","blocks_lemo4moodle/googlecharts","blocks_lemo4moodle/materialize"],function(a,b,c){function d(){function b(a,b){var c=new FileReader;c.onload=b,c.readAsText(a)}var d=a("#viewDialogThis").val(),e=a("#viewDialogAll").val(),f=a("#viewFile").val(),g=a("#viewTimespan").val(),h=a("#viewNoTimespan").val(),i=a("#viewModalError").val();a(document).ready(function(){a(window).resize(function(){block_lemo4moodle_drawAllCharts()}),a("#btn_close").click(function(){window.close()}),a("#tabs").tabs({onShow:block_lemo4moodle_drawAllCharts}),a("#dialog").dialog({autoOpen:!1,buttons:[{text:d,click:function(){a(this).dialog("close"),"tab1"==a(".active").attr("id")?(document.getElementById("allCharts1").value="false",document.getElementById("download_form_1").submit()):"tab2"==a(".active").attr("id")?(document.getElementById("allCharts2").value="false",document.getElementById("download_form_2").submit()):"tab3"==a(".active").attr("id")?(document.getElementById("allCharts3").value="false",document.getElementById("download_form_3").submit()):"tab4"==a(".active").attr("id")&&(document.getElementById("allCharts4").value="false",document.getElementById("download_form_4").submit())}},{text:e,click:function(){a(this).dialog("close"),"tab1"==a(".active").attr("id")?(document.getElementById("allCharts1").value="true",document.getElementById("download_form_1").submit()):"tab2"==a(".active").attr("id")?(document.getElementById("allCharts2").value="true",document.getElementById("download_form_2").submit()):"tab3"==a(".active").attr("id")?(document.getElementById("allCharts3").value="true",document.getElementById("download_form_3").submit()):"tab4"==a(".active").attr("id")&&(document.getElementById("allCharts4").value="true",document.getElementById("download_form_4").submit())}}]}),a("#file_merge").val(""),a("#file_merge").change(function(){var c=document.getElementById("file_merge");a("#file_merge_filenames").empty(),a("#file_merge_timespan").empty();for(var d=0;d<c.files.length;++d)a("#file_merge_filenames").append('<li class="black-text">'+f+(d+1)+": "+c.files[d].name+"</li><br>");for(var d=0;d<c.files.length;++d)b(c.files[d],function(b){var c=b.target.result;if(c.includes("var firstdate ")){var d=c.indexOf("var firstdate ="),e=c.indexOf('"',d),f=c.indexOf('"',e+1),i=c.substring(e+1,f),j=c.indexOf("var lastdate ="),k=c.indexOf('"',j),l=c.indexOf('"',k+1),m=c.substring(k+1,l);a("#file_merge_timespan").append('<li class="black-text">'+g+i+" - "+m+"</li><br>")}else a("#file_merge_timespan").append('<li class="black-text">'+h+"</li><br>")})})}),c.charts.load("47",{packages:["bar","line","treemap","corechart","controls"]}),c.charts.setOnLoadCallback(block_lemo4moodle_drawAllCharts),a(function(){a(".datepick").datepicker({dateFormat:"dd.mm.yy"})}),a(document).ready(function(){a(".modal").modal()});var j="";a("#mergeButton").click(function(){a("#modal_error2").text("");var c=document.querySelector("#file_merge");if(c.files.length<2)return void a("#modal_error2").text(i);for(var d,e=c.files,f=["linechartDataArray"],g=0,h=0;h<e.length;h++)b(e[h],function(b){d=b.target.result,f.forEach(function(b){var c,f=d.indexOf("[",d.indexOf("var "+b+" =")),h=d.indexOf(";",d.indexOf("var "+b+" =")),i=d.substring(f,h),k=i.substring(2,i.lastIndexOf("]]"));"linechartDataArray"==b?c=k.split("],["):"heatmapData"==b&&(c=k.split("], [")),c.forEach(function(d){if("linechartDataArray"==b&&d.toString().length>2&&(j.includes(d.toString())||(j+="["+d.toString()+"],"),c[c.length-1]==d&&g==e.length-1)){j=j.substring(1,j.lastIndexOf("],"));var f=new Array,h=j.split("],[");h.forEach(function(a){var b=a.split(","),c=[a.substring(1,a.lastIndexOf(")")),b[3],b[4],b[5]];f.push(c)}),j="";var i=JSON.stringify(f);a("#allCharts2").val("false"),a("#mergeData2").val(i),a("#download_form_2").submit(),a("#mergeData2").val("")}})}),g++})})}return{init:function(){d()}}});