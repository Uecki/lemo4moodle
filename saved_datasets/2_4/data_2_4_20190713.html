<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ActivityGraph</title>

    <!-- Datepicker jQuery -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://www.google.com/jsapi"></script>

    <!-- Materialize CSS Compiled and minified CSS -->
    <link rel="stylesheet" href="  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Google Charts - Draw Charts -->
    <script>


        // Load Charts and the corechart package.
        google.charts.load("current", { "packages": ["bar", "line", "corechart", "controls"] });

        // Draw the bar chart when Charts is loaded
        google.charts.setOnLoadCallback(drawBarChart);

        // Draw the line chart when Charts is loaded.
        google.charts.setOnLoadCallback(drawLineChart);



        var activity_chart;

        // Callback that draws the bar chart
        function drawBarChart() {
            var data = google.visualization.arrayToDataTable([['Dateiname', 'Zugriffe', 'Nutzer'],['Test PDF', 9, 2],['Test-PDF  2', 2, 1]]);

            var materialOptions_BarChart = {
                chart: {
                    title: "Zugriffe und Nutzer pro Datei"
                },
                axes: {
                    x: {
                        distance: { label: "Dateiname" } // bottom x-axis.
                    },
                    y: {
                        distance: { label: "Zugriffe" } // Left y-axis.
                    }
                },
                legend: {
                    position: "none"

                },
                bars: "horizontal"
            };

            // Instantiate and draw the bar chart 
            var materialBarChart = new google.charts.Bar(document.getElementById("bar_chart"));
            materialBarChart.draw(data, google.charts.Bar.convertOptions(materialOptions_BarChart));

        }



        // Callback that draws the activity chart
        function drawLineChart() {

            var data = new google.visualization.DataTable();
            data.addColumn("date", "Datum");
            data.addColumn("number", "Zugriffe");
            data.addColumn("number", "eigene Zugriffe")
            data.addColumn("number", "Nutzer");
            data.addRows([[(new Date(2019, 5, 25)), 3, 0, 1],[(new Date(2019, 5, 26)), 0, 0, 0],[(new Date(2019, 5, 27)), 0, 0, 0],[(new Date(2019, 5, 28)), 0, 0, 0],[(new Date(2019, 5, 29)), 0, 0, 0],[(new Date(2019, 5, 30)), 0, 0, 0],[(new Date(2019, 6, 01)), 0, 0, 0],[(new Date(2019, 6, 02)), 0, 0, 0],[(new Date(2019, 6, 03)), 0, 0, 0],[(new Date(2019, 6, 04)), 0, 0, 0],[(new Date(2019, 6, 05)), 37, 0, 1],[(new Date(2019, 6, 06)), 0, 0, 0],[(new Date(2019, 6, 07)), 0, 0, 0],[(new Date(2019, 6, 08)), 28, 19, 2],[(new Date(2019, 6, 09)), 0, 0, 0],[(new Date(2019, 6, 10)), 10, 10, 1],[(new Date(2019, 6, 11)), 20, 20, 1],[(new Date(2019, 6, 12)), 17, 17, 1],[(new Date(2019, 6, 13)), 1000, 1000, 1]]);

            //  echo $line_chart_data; ?>

            var options = {
                chart: {
                    title: "Zugriffe und Nutzer pro Tag"
                },
                hAxis: {
                    title: "Datum",
                    format: "d.M.yy"
                }


            };

            activity_chart = new google.visualization.LineChart(document.getElementById("line_chart"));
            activity_chart.draw(data, options);
        }



    </script>



    <script>

        $(function () {
            $(".datepick").datepicker({
                /*dateFormat: "mm/dd/yy"*/
                dateFormat: "dd.mm.yy"
            });

        });

    </script>

    <script>
        var js_activity = [['2019, 5, 25', 3, 0, 1],['2019, 5, 26', 0, 0, 0],['2019, 5, 27', 0, 0, 0],['2019, 5, 28', 0, 0, 0],['2019, 5, 29', 0, 0, 0],['2019, 5, 30', 0, 0, 0],['2019, 6, 01', 0, 0, 0],['2019, 6, 02', 0, 0, 0],['2019, 6, 03', 0, 0, 0],['2019, 6, 04', 0, 0, 0],['2019, 6, 05', 37, 0, 1],['2019, 6, 06', 0, 0, 0],['2019, 6, 07', 0, 0, 0],['2019, 6, 08', 28, 19, 2],['2019, 6, 09', 0, 0, 0],['2019, 6, 10', 10, 10, 1],['2019, 6, 11', 20, 20, 1],['2019, 6, 12', 17, 17, 1],['2019, 6, 13', 1000, 1000, 1]];

        function toTimestamp(strDate) {
            var datum = Date.parse(strDate);
            return datum / 1000;
        }
        $(document).ready(function () {
            $("#dp_button_2").click(function () {
                var start = document.getElementById("datepicker_3").value;
                var end = document.getElementById("datepicker_4").value;
                /* rewrite date */
                var s = start.split(".");
                start = s[1] + "/" + s[0] + "/" + s[2];
                /* rewrite date */
                var e = end.split(".");
                end = e[1] + "/" + e[0] + "/" + e[2];
                start += " 00:00:00";
                end += " 23:59:59";
               
                var tp_start = toTimestamp(start);
                var tp_end = toTimestamp(end);
               
                if (tp_start <= tp_end) {
                    var activity_data = [];
                    js_activity.forEach(function (item) {
                        if (item[3] >= tp_start && item[3] <= tp_end) {
                            activity_data.push({
                                date: item[0],
                                accesses: item[1],
                                ownhits: item[2],
                                users: item[3]
                                });
                        }
                    });
                    console.log(activity_data);
                    var chartData = activity_data.map(function (it) {
                        var str = it.date;
                        r = str.split(", ");
                        return [new Date(r[0], r[1], r[2]), it.accesses, it.ownhits, it.users];
                    });
                    console.log(chartData);
                    var data = new google.visualization.DataTable();
                    data.addColumn("date", "Datum");
                    data.addColumn("number", "Zugriffe");
                    data.addColumn("number", "eigene Zugriffe");
                    data.addColumn("number", "Nutzer");
                    data.addRows(chartData);
                    var options = {
                        chart: {
                            title: "Zugriffe und Nutzer pro Tag"
                        },
                        hAxis: {
                            title: "Datum",
                            format: "d.M.yy"
                        }
                    };
                    activity_chart.draw(data, options);
                } else {
                    // Materialize.toast(message, displayLength, className, completeCallback);
                    Materialize.toast("Überprüfen Sie ihre Auswahl (Beginn < Ende)", 3000) // 4000 is the duration of the toast
                    $("#datepicker_3").val("");
                    $("#datepicker_4").val("");
                }

            });
        });
    </script>
    <!-- Reset Charts (BarChart, LineChart) -->
    <script>
        $(document).ready(function () {
            /* Bar Chart - reset button */
            $("#rst_btn_2").click(function () {
                var data = new google.visualization.DataTable();
                data.addColumn("date", "Datum");
                data.addColumn("number", "Zugriffe");
                data.addColumn("number", "eigene Zugriffe")
                data.addColumn("number", "Nutzer");
                data.addRows([[(new Date(2019, 5, 25)), 3, 0, 1],[(new Date(2019, 5, 26)), 0, 0, 0],[(new Date(2019, 5, 27)), 0, 0, 0],[(new Date(2019, 5, 28)), 0, 0, 0],[(new Date(2019, 5, 29)), 0, 0, 0],[(new Date(2019, 5, 30)), 0, 0, 0],[(new Date(2019, 6, 01)), 0, 0, 0],[(new Date(2019, 6, 02)), 0, 0, 0],[(new Date(2019, 6, 03)), 0, 0, 0],[(new Date(2019, 6, 04)), 0, 0, 0],[(new Date(2019, 6, 05)), 37, 0, 1],[(new Date(2019, 6, 06)), 0, 0, 0],[(new Date(2019, 6, 07)), 0, 0, 0],[(new Date(2019, 6, 08)), 28, 19, 2],[(new Date(2019, 6, 09)), 0, 0, 0],[(new Date(2019, 6, 10)), 10, 10, 1],[(new Date(2019, 6, 11)), 20, 20, 1],[(new Date(2019, 6, 12)), 17, 17, 1],[(new Date(2019, 6, 13)), 1000, 1000, 1]]);
                var options = {
                    chart: {
                        title: "Zugriffe und Nutzer pro Tag"
                    },
                    hAxis: {
                        title: "Datum",
                        format: "d/M/yy"
                    }
                };
                activity_chart.draw(data, options);
                $("#datepicker_3").val("");
                $("#datepicker_4").val("");
            });


        });
    </script>

    <!-- redraw charts when its tab is clicked -->
    <script>
        $(document).ready(function () {
            $("#tab_barChart").click(function () {
                drawBarChart();

            });
            $("#tab_activityChart").click(function () {
                drawLineChart();


            });
        });

    </script>

    <style>
        .brand-logo {
            margin-left: 25px;
        }



        .nav-wrapper {
            background-color: #D92425;
        }

        .tabs .tab a {
            color: #D92425;
            background-color: #ffffff;
        }

        /*text color*/

        .tabs .tab a:hover {

            color: #000;
        }

        /*Text color on hover*/

        .tabs .tab a.active {

            color: #D92425;
        }

        /*Background and text color when a tab is active*/

        .tabs .indicator {
            background-color: #D92425;
        }

        /*Color of underline*/

        .tabs .tab.disabled a {
            color: #D92425;
        }

        .tabs .tab.disabled a:hover {
            color: #D92425;
        }

        button {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        #bar_chart {
            width: 100% !important;
            min-height: 500px !important;
        }

        #line_chart {
            width: 100% !important;
            min-height: 500px !important;
        }

        .col .s9 {
            min-height: 500px !important;
        }

        #chart_div {
            width: 100% !important;
            min-height: 500px !important;
        }

        h3 {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 15px;
            font-weight: bold;
        }

        .chart {
            max-width: 100%;
            min-height: 450px;
        }

        .announcement {
            margin: 0px;
            padding: 5px;
        }

        .announcement-link {
            color: #0d47a1;
        }

        .red-text {
            color: #D92425;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="col s12 yellow darken-1 announcement">
            <p class="center-align">
                <i class="material-icons">announcement</i>
                Internetverbindung erforderlich! Lokale Version (Daten nur bis 13.07.19) Aktuelle Daten unter:
                <a href="https://moodle.hwr-berlin.de/" class="announcement-link">moodle.hwr-berlin.de</a>
            </p>
        </div>
        <nav>
            <div class="nav-wrapper">
                <a onClick="window.location.reload()" class="brand-logo">
                    <i class="material-icons">insert_chart</i>ActivityGraph</a>
                <ul id="nav" class="right hide-on-med-and-down">
                    <li>
                        <a href="http://www.hwr-berlin.de/home/" class="waves-effect waves-light btn white red-text" id="btn_hwr" target="_blank">www.hwr-berlin.de
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="row">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab disabled">
                        <a href="#">Lokale Version erstellt: 13.07.19</a>
                    </li>
                    <li class="tab" id="tab_barChart">
                        <a class="active" href="#chart1">Bar Chart</a>
                    </li>
                    <li class="tab" id="tab_activityChart">
                        <a href="#chart2">Activity Chart</a>
                    </li>
                    <li class="tab disabled" id="tab_heatMap">
                        <a href="#chart3">not finished (heat map)</a>
                    </li>
                    <li class="tab disabled" id="tab_treeMap">
                        <a href="#chart4">not finished (tree map)</a>
                    </li>
                </ul>
            </div>
            <div id="chart1" class="col s12">
                <div class="row">
                    <div class="col s9 chart">
                        <div id="bar_chart" class="chart"></div>
                    </div>
                    <div id="options" class="col s3">
                        <div class="row">
                            <div class="input-field col s12">
                                <!-- place filter options here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chart2" class="col s12">
                <div class="row">
                    <div class="col s9 chart">
                        <div id="line_chart" class="chart"></div>
                    </div>
                    <div id="options" class="col s3">
                        <div class="row">
                            <div class="input-field col s12">
                                <p>Filter:</p>
                                <input placeholder="Beginn" type="text" class="datepick " id="datepicker_3">
                                <input placeholder="Ende" type="text" class="datepick " id="datepicker_4">
                                <button class="btn waves-effect waves-light grey darken-3 button" type="submit" name="action" id="dp_button_2">Aktualisieren</button>
                                <button class="btn waves-effect waves-light grey darken-3 button" type="submit" name="action" id="rst_btn_2">R&uuml;ckg&auml;ngig</button>
                                <div class="divider"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chart3" class="col s12">
                <div class="row">
                    <div class="col s9 chart">
                        <!-- place chart here -->
                    </div>
                    <div id="options" class="col s3">
                        <div class="row">
                            <div class="input-field col s12">
                                <!-- place filter here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="chart4" class="col s12">
                <div class="row">
                    <div class="col s9 chart">
                        <!-- place chart here -->
                    </div>
                    <div id="options" class="col s3">
                        <div class="row">
                            <div class="input-field col s12">
                                <!-- place filter here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="report">
            <ul class="collapsible z-depth-0" data-collapsible="accordion">
                <li>
                    <div class="collapsible-header">
                        <i class="material-icons right">expand_more</i>Kursaktivität (Moodle Bericht)</div>
                    <div class="collapsible-body">
                        <span>
                        <table class="generaltable boxaligncenter" id="outlinetable" cellpadding="5">
<thead>
<tr>
<th class="header c0" style="" scope="col">Aktivität</th>
<th class="header c1" style="" scope="col">Zugriffe</th>
<th class="header c2" style="" scope="col">Ähnliche Blogeinträge</th>
<th class="header c3 lastcol" style="" scope="col">Letzter Zugriff</th>
</tr>
</thead>
<tbody><tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Forum" title="Forum" src="http://localhost:8080/moodle/theme/image.php/boost/forum/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/forum/view.php?id=1">Ankündigungen</a></td>
<td class="numviews cell c1 cell c1" style="">-</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style=""></td>
</tr>
<tr class="section">
<td class="cell c0 lastcol cell c0 lastcol" style="" colspan="4"><h3>Thema 1</h3></td>
</tr>
<tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Datei" title="Datei" src="http://localhost:8080/moodle/theme/image.php/boost/resource/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/resource/view.php?id=2">Test PDF</a></td>
<td class="numviews cell c1 cell c1" style="">8 Ansichten von 2 Nutzer/innen</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style="">Mittwoch, 10. Juli 2019, 09:59 (3 Tage 1 Stunde)</td>
</tr>
<tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Forum" title="Forum" src="http://localhost:8080/moodle/theme/image.php/boost/forum/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/forum/view.php?id=5">Test Forum</a></td>
<td class="numviews cell c1 cell c1" style="">6 Ansichten von 2 Nutzer/innen</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style="">Donnerstag, 11. Juli 2019, 15:10 (1 Tag 20 Stunden)</td>
</tr>
<tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Datei" title="Datei" src="http://localhost:8080/moodle/theme/image.php/boost/resource/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/resource/view.php?id=6">Test-Worddokument</a></td>
<td class="numviews cell c1 cell c1" style="">1 Ansichten von 1 Nutzer/innen</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style="">Montag, 8. Juli 2019, 19:24 (4 Tage 15 Stunden)</td>
</tr>
<tr class="section">
<td class="cell c0 lastcol cell c0 lastcol" style="" colspan="4"><h3>Thema 2</h3></td>
</tr>
<tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Chat" title="Chat" src="http://localhost:8080/moodle/theme/image.php/boost/chat/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/chat/view.php?id=3">Test Chat</a></td>
<td class="numviews cell c1 cell c1" style="">1 Ansichten von 1 Nutzer/innen</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style="">Freitag, 5. Juli 2019, 12:02 (7 Tage 23 Stunden)</td>
</tr>
<tr class="">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Datei" title="Datei" src="http://localhost:8080/moodle/theme/image.php/boost/resource/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/resource/view.php?id=7">Test-PDF  2</a></td>
<td class="numviews cell c1 cell c1" style="">2 Ansichten von 1 Nutzer/innen</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style="">Montag, 8. Juli 2019, 19:25 (4 Tage 15 Stunden)</td>
</tr>
<tr class="section">
<td class="cell c0 lastcol cell c0 lastcol" style="" colspan="4"><h3>Thema 3</h3></td>
</tr>
<tr class="lastrow lastrow">
<td class="activity cell c0 cell c0" style=""><img class="icon icon" alt="Glossar" title="Glossar" src="http://localhost:8080/moodle/theme/image.php/boost/glossary/1561289286/icon" /><a href="http://localhost:8080/moodle/mod/glossary/view.php?id=4">Test Glossar</a></td>
<td class="numviews cell c1 cell c1" style="">-</td>
<td class="blog cell c2 cell c2" style="">-</td>
<td class="lastaccess cell c3 lastcol cell c3 lastcol" style=""></td>
</tr>
</tbody>
</table>

                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- make charts responsive -->
    <script>
        $(window).resize(function () {
            drawBarChart();
            drawLineChart();
        });

    </script>
</body>

</html>